// Game Content for Redemption Game
// This file contains all the narrative content for the game

export const gameContent = {
    // Title screen
    title: "Luminance",

    // Narratives for each round
    narratives: {
        1: {
            default: "Your name is Stanislav.<br><br>You live in a vast old country whose greatness is behind her perhaps. Yes, there are those as you who polished the right elbows and found themselves esteemed positions as high-ranking military officials. But you know, as everyone knows, that for every well-housed noble there are a hundred hungry mouths, crying out in the black of night until they fall silent.<br><br>What the world sees is the behemoth veteran of the bloodshed of centuries, a giant for whom it is best to permit sleep. Only those as you know the truth.",
            options: {
                A: "In spite of her shortcomings, here is home also to your small family, your small peace",
                C: "You could watch it all burn"
            },
            consequences: {
                A: "It is all you have ever known, and it keeps you far from dead. Indeed you and your family are quite alive.<br><br>You dream of traveling someday. Maybe once your children are adults and travel is unrestricted, you and your wife might see the things from the books and FBA movies.",
                C: "When ceased your affection for your motherland? For how long have you heeded her warm or frosty call not with love or anger but unconcern only? For how long have memories of the quiet village of your birth failed to elicit the smallest tenderness?<br><br>In reality, it makes nausea for you to think once you loved this place or these people."
            }
        },

        2: {
            X: {
                text: "You are forty-four years old.<br><br>It was your birthday recently. Your wife Julia forgot and made final moment festivities.",
                options: {
                    A: "She did her best",
                    B: "She has been married to you ten years already!",
                    C: "She should not have bothered"
                },
                consequences: {
                    A: "Good friends attended and an appropriate amount of vodka was libated. Luckily no one pulls your ears anymore, you are so old they would have fallen off probably. Especially you appreciated her efforts because she has seemed so tired lately. You even were turning blind the absconsion of the remaining food and additionally the party decorations by your scoundrel brother-in-law. You supposed no one takes these things unless they need them.<br><br>However you did not enjoy when your birthday candles put flames to your beard. Additionally however, everyone else did.",
                    B: "And every year she forgets! She even dared to invite Ilya your scoundrel brother-in-law, who himself dared to appropriate arms full of what he was calling leftovers for his personal use. This included not only the remaining feast but the party decorations additionally.<br><br>Do not even ask about when your birthday candles put flames to your beard.",
                    C: "All those people, your supposed friends, coming together only when food and libations are financed. The party caused you only depression for that you and these fiends traverse quite disparate paths. Your scoundrel brother-in-law Ilya thieved the remaining food and also party decorations, which deepened your despondency.<br><br>Additionally your birthday candles put flames to your beard. You did not know you could appear more ugly or foolish but you suppose advanced age holds many more such surprises."
                }
            },
            Y: {
                text: "You are forty-four years old.<br><br>It was your birthday recently. Your wife Julia forgot and made final moment festivities.",
                options: {
                    A: "She did her best",
                    B: "She has been married to you ten years already!",
                    C: "She should not have bothered"
                },
                consequences: {
                    A: "Good friends attended and an appropriate amount of vodka was libated. Luckily no one pulls your ears anymore, you are so old that they probably would have fallen off. You appreciated her efforts especially because she has seemed so tired lately. You even were turning blind of the thievery of the remaining food and additionally the party decorations by your scoundrel brother-in-law, though you were not happy about it. Especially you did not enjoy when your birthday candles put flames to your beard, though everyone else did.",
                    B: "And every year she forgets! She even dared to invite Ilya your scoundrel brother-in-law, who himself dared to appropriate arms full of what he called leftovers for his personal use. This included not only the remaining feast but the party decorations additionally.<br><br>Do not even ask about when your birthday candles put flames to your beard. Who knew such an ugly slab of a man could be uglier?",
                    C: "All those people, your supposed friends, coming together only when food and libations are financed. The party caused you only depression for that you and these fiends traverse quite disparate paths. Then Julia permitted her scoundrel brother-in-law Iyla to thieve the remaining food and the party decorations also. Perhaps your assertion unfair but she did nothing to stop him. Her disrespect and that of your peers and outrageous in-laws deepened your despondency.<br><br>Additionally your birthday candles put flames to your beard. You did not know you could appear more ugly or foolish but you suppose advanced age holds many more surprises as this.<br><br>Since, sometimes you have the feeling of standing on the edge of a profound hole. Other times yet you feel as though you are at the bottom of this profound hole.<br><br>If a single other soul suffers as you do, either they are dead or unmet by you."
                }
            },
        },

        3: {
            X: {
                text: "Speaking of Julia, this morning you hear her in the kitchen, coughing softly.",
                options: {
                    A: "Appreciate her kindness to permit for you further sleep",
                    B: "Check the time though you are sure you are becoming late already due to her negligence",
                    C: "Consider to not leave the bed"
                },
                consequences: {
                    A: "Even though this could make you late for work, you are grateful for the gesture and feel a wink of what drew you to her in the first place. It is the small kindnesses - an old man stooping to replace a return the lost flower hat of a child, or Emile the immigrant boy feeding the stray cats of the neighborhood. Or Julia as a young baker girl in a red dress, surrendering her seat on the train for a critically pregnant woman.<br><br>Seeing Julia with Vanya and Stan Jr. touches you especially. If Heaven were real, could it be something so humble as this little life you have built together?<br><br>Though her coughs concern you.",
                    B: "This woman has no organs for running a household. But you knew this and still you had two children with her. Between you both, you cannot decide who is more empty-headed. For example, for days she has claimed she will go to the doctor about this cough and still the cough persists, waking you up in the night. Perhaps she is waiting for a sign from Heaven (which is imaginary, you reshape the phrase only).",
                    C: "On some dark days you think it would be nothing to remain under the covers until you wasted away in the fashion of an anorexic saint. A martyr to the cause of causelessness. (Saints and martyrs being imaginary figures, you reshape the constructs only.) Now you lay and reflect how Julia is growing farther away in spirit. She did not wake you because she cannot stand the sight of you, perhaps, a reminder of the richer, stronger, more beautiful men she could have been with. Perhaps.<br><br>You hear little of her noise besides her coughs."
                }
            },
            Y: {
                text: "Speaking of Julia, this morning her coughs from the kitchen are so loud as to wake you.",
                options: {
                    A: "Appreciate her kindness to permit for you further sleep",
                    B: "Check the time though you are sure you are becoming late due to her negligence",
                    C: "Consider to not leave the bed"
                },
                consequences: {
                    A: "Even though this could make you late for work, you are grateful for the gesture. Small kindnesses that tend to go unnoticedâ€“an old man stooping to replace the lost flower hat of a child, or Emile the immigrant boy feeding the stray cats of the neighborhood. Or Julia as a young baker girl in a red dress, surrendering her seat on the train for a critically pregnant woman.<br><br>Seeing Julia with Vanya and Stan Jr. touches you especially. Were God real and legal to thank, you might for your luck.<br><br>Though her coughs are starting to concern you.",
                    B: "This woman has no organs for running a household. But you knew this and still had two children with her. Between you both, you cannot decide who is more empty-headed. For example, for days she has claimed she will go to the doctor regarding this cough and still the cough persists, waking you up in the night. Perhaps she waits for an invitation from heaven (which is imaginary, you are reshaping the phrase only).",
                    C: "It would be nothing to lay under the covers until you wasted away in the fashion of an anorexic saint. A martyr to the cause of causelessness. (Saints and martyrs being imaginary figures, you are reshaping the constructs only.)<br><br>Lately you have felt Julia is becoming far away in spirit. Probably she did not wake you because she cannot stand the sight of you, a reminder of the richer, stronger, more beautiful men she could have been with. You are certain you have seen her smirk in disgust when you tell her about your day, its dull ups and downs, so you have stopped telling her about it at all. You hear little of her noise besides her coughs."
                }
            },
        },

        36: {
            W: "You've come so far, and the weight of your journey is evident in your confident stride. The final challenge awaits.",
            X: "The path has been long, but you can see how far you've come. The final test is near.",
            Y: "Despite the challenges, you've made it this far. The final stretch seems daunting but not impossible.",
            Z: "The journey has taken its toll, but you're still standing. One last effort remains.",
            options: {
                A: "Face the final challenge with courage",
                B: "Gather your strength before proceeding",
                C: "Question if you're ready for this"
            },
            consequences: {
                A: "You steel yourself for what's to come, ready to face the final challenge.",
                B: "You take a moment to prepare, knowing the importance of what's ahead.",
                C: "Your doubts linger, but you know you must continue regardless."
            }
        },

        37: {
            M: {
                text: "You've chosen the path of redemption. The road has been difficult, but you've grown stronger for it.",
                options: {
                    M: "Embrace your journey",
                    N: "Question your path"
                }
            },
            N: {
                text: "Your journey has taken an unexpected turn. The path ahead is unclear, but you press on.",
                options: {
                    M: "Return to the main path",
                    N: "Continue down this new road"
                }
            }
        },

        38: {
            M: {
                W: "As you reach the end of your journey, you feel a profound sense of peace. You've not only found redemption but have become a beacon of hope for others.",
                X: "The journey concludes with a quiet satisfaction. You've made peace with your past and look forward to the future.",
                Y: "The road ends here, but the journey continues within. You've found some measure of redemption, though the path was never easy.",
                Z: "The end comes not with a bang but with quiet acceptance. The path to redemption continues, but you've taken the first important steps.",
                options: {
                    M: "Reflect on your journey"
                }
            },
            N: {
                W: "The path has led you to unexpected places, but you've made the most of the journey. Sometimes the destination isn't what we expect, but it's exactly where we need to be.",
                X: "Your journey took turns you never anticipated, but you've arrived at a place of understanding. The path may have been winding, but it was yours to walk.",
                Y: "The road was harder than you imagined, but you've come through it changed. The destination may not be what you expected, but it's where you're meant to be.",
                Z: "The journey has been long and difficult, and the destination is not what you envisioned. But even in the darkness, there are lessons to be learned and strength to be found.",
                options: {
                    N: "Consider the path you've taken"
                }
            }
        }
    }
};

// Helper function to shuffle an object's entries
function shuffleObject(obj) {
    const entries = Object.entries(obj);
    for (let i = entries.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [entries[i], entries[j]] = [entries[j], entries[i]];
    }
    return Object.fromEntries(entries);
}

// Helper function to get the variant based on redemption rate
export function getVariant(redemptionRate) {
    if (redemptionRate >= 75) return 'W';
    if (redemptionRate >= 50) return 'X';
    if (redemptionRate >= 25) return 'Y';
    return 'Z';
}

// Get narrative text
export function getNarrative(round, redemptionRate, previousChoice = null) {
    if (round >= 37) {
        const variant = getVariant(redemptionRate);
        if (round === 37) {
            return previousChoice
                ? gameContent.narratives[round][previousChoice]?.text
                : gameContent.narratives[round];
        } else if (round === 38) {
            return previousChoice
                ? gameContent.narratives[round][previousChoice]?.[variant]
                : gameContent.narratives[round];
        }
    }

    const variant = getVariant(redemptionRate);
    const roundData = gameContent.narratives[round];

    if (roundData[variant] && typeof roundData[variant] === 'object' && roundData[variant].text) {
        return roundData[variant].text;
    } else if (roundData[variant]) {
        return roundData[variant];
    } else {
        return roundData?.default || `Round ${round} narrative...`;
    }
}

// Get options for current round
export function getOptions(round, redemptionRate, previousChoice = null) {
    let options;

    if (round === 1) {
        options = gameContent.narratives[1].options;
        return shuffleObject(options);
    }

    if (round >= 37) {
        if (previousChoice) {
            options = gameContent.narratives[round][previousChoice]?.options ||
                     { M: "Option M", N: "Option N" };
        } else {
            options = { M: "Option M", N: "Option N" };
        }
        return shuffleObject(options);
    }

    const variant = getVariant(redemptionRate);
    const roundData = gameContent.narratives[round];

    if (roundData[variant]?.options) {
        options = roundData[variant].options;
    } else if (roundData.options) {
        options = roundData.options;
    } else {
        options = {
            A: "Option A",
            B: "Option B",
            C: "Option C"
        };
    }

    return shuffleObject(options);
}

// Get consequence of a choice
export function getConsequence(round, choice, redemptionRate, previousChoice = null) {
    const variant = getVariant(redemptionRate);
    const roundData = gameContent.narratives[round];

    if (round >= 37 && previousChoice) {
        if (roundData[previousChoice]?.consequences?.[choice]) {
            return roundData[previousChoice].consequences[choice];
        }
    }

    if (roundData[variant]?.consequences?.[choice]) {
        return roundData[variant].consequences[choice];
    }

    if (roundData.consequences?.[choice]) {
        return roundData.consequences[choice];
    }

    return `You chose ${choice}. The consequences of your actions become clear...`;
}

